{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container hero">
    <!-- Search Bar -->
    <form method="get" class="d-flex align-items-center gap-2 w-100 candidate-search position-relative">
      <input type="text" 
             class="form-control px-4 py-3 border-1 shadow-none" 
             name="q" 
             id="searchInput"
             placeholder="Who are you looking for?" 
             value="{{ request.GET.q }}">
      
      <!-- Clear button -->
      <button type="button" 
              id="clearSearchBtn" 
              class="btn btn-sm btn-light position-absolute end-0 me-5 d-none" 
              style="top: 50%; transform: translateY(-50%);">
        <i class="fas fa-times"></i>
      </button>
    
      <button class="btn button-base scn-button d-flex justify-content-center align-items-center rounded-circle" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>
</div>

<div class="container py-5">
  <!-- Header / Controls -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    
    <!-- Sort dropdown -->
    <form id="sortForm" class="d-flex align-items-center">
      <select name="sort" id="sortSelect" class="form-select w-auto">
        <option value="" {% if not request.GET.sort %}selected{% endif %}>Default (Newest first)</option>
        <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>Alphabetical (A–Z)</option>
      </select>
    </form>

    <!-- Tabs -->
    <ul class="nav nav-pills justify-content-center flex-grow-1">
      <li class="nav-item">
        <a class="nav-link {% if not active_title %}active{% endif %}" href="{% url 'dashboard' %}">All</a>
      </li>
      {% for title in job_titles %}
      <li class="nav-item">
        <a class="nav-link {% if active_title == title.job_title %}active{% endif %}" href="?title={{ title.job_title|urlencode }}">
          {{ title.job_title }}
        </a>
      </li>
      {% endfor %}
    </ul>

    <!-- Favorite button -->
    <button id="favoritesToggle" type="button" class="btn btn-outline-dark d-flex align-items-center gap-2">
      <i class="fas fa-heart"></i> Show Favorites
    </button>

</div>

  <!-- Candidates -->

  {% if candidates %}
  <div class="row g-4">
    {% for candidate in candidates %}
    <div class="col-md-4 col-sm-6">
      <div class="candidate-card bg-white position-relative">
        
        <!-- Hjärta -->
        <div class="position-absolute top-0 end-0 p-4">
          <span class="heart-icon" onclick="toggleFavorite({{ candidate.id }}, this)">
            <i class="fa{% if candidate.is_favorite %}-solid{% else %}-regular{% endif %} fa-heart"></i>
          </span>
        </div>
  
        <!-- Info -->
        <div class="px-4 pt-4 pb-2">
          <div class="d-flex align-items-center gap-3 mb-3">
            {% if candidate.profile_image %}
            <img src="{{ candidate.profile_image.url }}" alt="Profile Image" />
        {% else %}
        <img src="{% static 'media/images/user-pic.png' %}" alt="Profile Image" />
          {% endif %}
            <div>
              <h4 class="mb-0">{{ candidate.name }}</h4>
              <small class="text-muted">{{ candidate.job_title|default:'Candidate' }}</small>
            </div>
          </div>
  
          <div class="skill-container">
            {% with candidate.skill_list as skills %}
            {% for skill in skills|slice:":3" %}
              <span class="skill-badge">{{ skill }}</span>
            {% endfor %}
            {% if skills|length > 3 %}
              <span class="skill-badge">+{{ skills|length|add:"-3" }}</span>
            {% endif %}
          {% endwith %}
          </div>
        </div>
  
        <hr>
  
        <!-- Footer -->
        <div class="d-flex justify-content-between align-items-center px-4 pb-3">
          <a href="#" onclick="openCandidateModal({{ candidate.id|escapejs }})" class="btn button-base scn-button read-btn">Read more</a>
          <div class="dot-menu">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p>No candidates yet.</p>
  {% endif %}

</div>

</div>

{% endblock %}